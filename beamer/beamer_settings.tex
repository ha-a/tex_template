% !TEX root = main.tex

\usepackage{luatexja}% 日本語したい
\usepackage[ipaex]{luatexja-preset}% IPAexフォントしたい
\renewcommand{\kanjifamilydefault}{\gtdefault}% 既定をゴシック体に

% Beamerの設定
\usetheme{CambridgeUS}      % 全体テーマ
\useinnertheme{rectangles}  % 箇条書きスタイルとか
\usecolortheme{dolphin}     % 色テーマ

%==============================================================================

% Beamerのフォント設定
\usepackage[T1]{fontenc}    % おまじない
\usepackage{lmodern}      % New Century Schoolbook (cf. 美文書 p240)

% \usepackage{fourier}
% \usepackage[scaled=0.875]{helvet}
% \usepackage[scaled]{couriers}
% \usepackage{mathpazo}
% \usepackage[utopia]{mathdesign}

\usepackage[scaled]{helvet}
%\renewcommand{\sfdefault}{phv}
\renewcommand{\familydefault}{\sfdefault}    % 英文をサンセリフ体に
\usefonttheme[onlymath]{serif}               % 数式のみセリフ体に
%\usefonttheme{serif}

\usefonttheme{structurebold}                           % タイトル部を太字
\setbeamerfont{title}{size=\Large}                     % タイトル文字サイズ
\setbeamerfont{author}{series=\bfseries,size=\large}   % 著者文字サイズ・太字
\setbeamerfont{institute}{size=\footnotesize}          % 所属文字サイズ
\setbeamerfont{date}{size=\normalsize}                 % 日付文字サイズ
\setbeamerfont{alerted text}{series=\bfseries}         % Alertを太字
\setbeamerfont{section in toc}{series=\mdseries}       % 目次は太字にしない
\setbeamerfont{frametitle}{size=\Large}                % フレームタイトル文字サイズ

%==============================================================================
% Beamer色設定
\definecolor{MainTextColor}{RGB}{25,25,60}        % 本文カラー：青寄りの黒
\definecolor{AlertRed}{RGB}{192, 0, 51}           % Alert：若干青込赤
\definecolor{StructureBlue}{RGB}{30,30,120}       % Structure：青
\colorlet{BlertColor}{blue!80!gray}               % Blert

\setbeamercolor{structure}{fg=StructureBlue}              % 見出しカラー
\setbeamercolor{subtitle}{use=structure,fg=structure.bg}
\setbeamercolor{normal text}{fg=MainTextColor}            % 本文カラー

\setbeamercolor{block title}{use=structure,fg=white,bg=structure.fg!80!black}
\setbeamercolor{block body}{parent=normal text,use=block title,bg=block title.bg!10!bg}

\setbeamercolor{alerted text}{fg=AlertRed!90!gray}    % \alert 文字カラー
\setbeamercolor{block title alerted}{use=alerted text,fg=white,bg=alerted text.fg!75!black}
\setbeamercolor{block body alerted}{parent=normal text,use=block title alerted,bg=block title alerted.bg!10!bg}

\setbeamercolor{example text}{use=structure,fg=structure.fg}
\setbeamercolor{block title example}{use=structure,fg=white,bg=structure.fg!80!black}
\setbeamercolor{block body example}{parent=normal text,use=block title example,bg=block title example.bg!10!bg}

\setbeamercolor{gray box}{fg=MainTextColor,bg=gray!50!white}

% Babel (日本語の場合のみ・英語の場合は不要)
\uselanguage{japanese}
\languagepath{japanese}
\deftranslation[to=japanese]{Theorem}{定理}
\deftranslation[to=japanese]{Lemma}{補題}
\deftranslation[to=japanese]{Example}{例}
\deftranslation[to=japanese]{Examples}{例}
\deftranslation[to=japanese]{Definition}{定義}
\deftranslation[to=japanese]{Definitions}{定義}
\deftranslation[to=japanese]{Problem}{問題}
\deftranslation[to=japanese]{Solution}{解}
\deftranslation[to=japanese]{Fact}{事実}
\deftranslation[to=japanese]{Proof}{証明}
\def\proofname{証明}
\usepackage{latexsym}       % 証明終のマーク
\def\qed{\hfill $\Box$}

\setbeamertemplate{theorems}[numbered]  % 定理に番号をつける
% \newtheorem{thm}{Theorem}[section]

\setbeamertemplate{navigation symbols}{}        % 下の変なマークたちを消す
\setbeamertemplate{enumerate item}[default]     % 単純な数字に
\setbeamertemplate{itemize item}[triangle]      % 三角形に
\setbeamertemplate{blocks}[rounded]             % block は角丸


\AtBeginSection[]{      % section が始まる毎に目次表示
% \ifnum \insertsectionnumber = [section number+1]  % 特定の section 前の目次
%     \begin{frame}
%         \tableofcontents[currentsection,hideothersubsections]
%         \centering
%         特定の章前の目次で特別ななにかを記述したければここ
%         使うときは下の \verb|\|\texttt{fi} に挟まれた \verb|%| も外すんだよ
%     \end{frame}
% \else{
\ifnum \insertframenumber > \inserttotalframenumber   % Appendix 目次
    \begin{frame}[noframenumbering]{Table of Contents}
        % 現 section
        %     - subsection
        % 他 section (shaded)
        % \tableofcontents[currentsection,hideothersubsections]
        \tableofcontents[currentsection,hideothersubsections,firstsection=6]
            % Appendix の section は本編の通し番号
            % firstsection=[本編 last section number + 1]
        % 現 section
        % 他 section (shaded)
        % \tableofcontents[sectionstyle=show/shaded,hideallsubsections,firstsection=5]
    \end{frame}
\else
    \begin{frame}[noframenumbering]{Table of Contents}
        % 現 section
        %     - subsection
        % 他 section (shaded)
        \tableofcontents[currentsection,hideothersubsections]

        % 現 section
        % 他 section (shaded)
        % \tableofcontents[sectionstyle=show/shaded,hideallsubsections]
    \end{frame}
\fi
% }
% \fi
}

%==============================================================================

% margin settings
\setbeamersize{text margin left=10mm,text margin right=10mm}

% footline settings
\defbeamertemplate*{footline}{titlefoot theme}
{
\ifnum \insertpagenumber=1  % 表紙フッター枠のみ
    \leavevmode%
    \hbox{%
        \begin{beamercolorbox}[wd=.3333\paperwidth, ht=2.25ex,dp=1ex,center]{author in head/foot}%
            \usebeamerfont{title in head/foot}
        \end{beamercolorbox}%
        \begin{beamercolorbox}[wd=.3333\paperwidth, ht=2.25ex,dp=1ex,center]{title in head/foot}%
            \usebeamerfont{title in head/foot}
        \end{beamercolorbox}%
        \begin{beamercolorbox}[wd=.3333\paperwidth, ht=2.25ex,dp=1ex,center]{date in head/foot}%
            \usebeamerfont{date in head/foot}
        \end{beamercolorbox}
    }%
    \vskip0pt%
\else            % 表紙以外のページは 著者(所属) | ページ数/総ページ数 | 日付
    \leavevmode%
    \hbox{%
        \begin{beamercolorbox}[wd=.3333\paperwidth, ht=2.25ex,dp=1ex,center]{author in head/foot}%
            \usebeamerfont{title in head/foot}\insertshortauthor (\insertshortinstitute)
        \end{beamercolorbox}%
        \begin{beamercolorbox}[wd=.3333\paperwidth, ht=2.25ex,dp=1ex,center]{title in head/foot}%
            \usebeamerfont{title in head/foot}\insertframenumber{} / \inserttotalframenumber
        \end{beamercolorbox}%
        \begin{beamercolorbox}[wd=.3333\paperwidth, ht=2.25ex,dp=1ex,center]{date in head/foot}%
            \usebeamerfont{date in head/foot}\insertshortdate{}
        \end{beamercolorbox}
    }%
    \vskip0pt%
\fi
}
\setbeamertemplate{footline}[titlefoot]
\setbeamerfont{footline}{family=\ttfamily}

% \appendix 環境もページカウント
% ただし，total frame number は本編のみ
\newcommand{\beginbackup}{
   \newcounter{framenumbervorappendix}
   \setcounter{framenumbervorappendix}{\value{framenumber}}
}
\newcommand{\backupend}{
   \addtocounter{framenumbervorappendix}{-\value{framenumber}}
   \addtocounter{framenumber}{\value{framenumbervorappendix}}
}

% headline settings
\defbeamertemplate*{headline}{titlehead theme}
{
\ifnum \insertpagenumber=1  % 表紙ヘッダー枠のみ
    \leavevmode%
    \hbox{%
        \begin{beamercolorbox}[wd=.4999\paperwidth , ht=2.65ex,dp=1.5ex,right]{title in head/foot}%
            \usebeamerfont{title in head/foot}
        \end{beamercolorbox}%
        \begin{beamercolorbox}[wd=.4999\paperwidth , ht=2.65ex,dp=1.5ex,left]{section in head/foot}%
            \usebeamerfont{section in head/foot}
        \end{beamercolorbox}%
    }%
    \vskip0pt%
\else{\ifnum \insertframenumber > \inserttotalframenumber   % Appendix ヘッダー
    \leavevmode             % title | Appendices / section
    \hbox{%
        \begin{beamercolorbox}[wd=.4999\paperwidth , ht=2.65ex,dp=1.5ex,right]{title in head/foot}%
            \usebeamerfont{title in head/foot}\insertshorttitle\hspace*{3ex}
        \end{beamercolorbox}%
        \begin{beamercolorbox}[wd=.4999\paperwidth , ht=2.65ex,dp=1.5ex,left]{section in head/foot}%
            \usebeamerfont{section in head/foot}\hspace*{3ex}Appendices / \insertsectionhead
        \end{beamercolorbox}%
    }%
    \vskip0pt%
\else                       % 表紙以外は title | section
    \leavevmode%
    \hbox{%
        \begin{beamercolorbox}[wd=.4999\paperwidth , ht=2.65ex,dp=1.5ex,right]{title in head/foot}%
            \usebeamerfont{title in head/foot}\insertshorttitle\hspace*{3ex}
        \end{beamercolorbox}%
        \begin{beamercolorbox}[wd=.4999\paperwidth , ht=2.65ex,dp=1.5ex,left]{section in head/foot}%
            \usebeamerfont{section in head/foot}\hspace*{3ex}\insertsectionhead
        \end{beamercolorbox}%
    }%
    \vskip0pt%
\fi}\fi
}
\setbeamertemplate{headline}[titlehead]

% title page setting
\makeatletter

\def\thesis#1{\def\@thesis{#1}}
\def\id#1{\def\@id{#1}}

\usepackage{ifthen}

\setbeamertemplate{title page}{
    \vbox{}
    \vfill
    \begingroup
    \centering

    % 特別研究とか論文の区分的な？
    \ifthenelse{\isundefined{\@thesis}}{}{
        \begin{beamercolorbox}[sep=0pt,center]{institute}
            {\Large \@thesis \par} 
        \end{beamercolorbox}
        \vskip0.4em
    }
    
    \hfill
    \begin{beamercolorbox}[rounded=true,sep=1mm,shadow=true,wd=.8\hsize,center]{block title}
        {\usebeamerfont{title}\inserttitle\par}
    \end{beamercolorbox}
    \hfill\hfill
    \ifx\insertsubtitle\@empty      % subtitle なければ
    \else                           % subtitle あれば
        \vskip0.5em%
        \begin{beamercolorbox}[sep=0pt,center]{author}
            {\usebeamerfont{subtitle}\usebeamercolor{subtitle}\insertsubtitle\par}%
        \end{beamercolorbox}
    \fi%

    \vskip1.5em\par
    \begin{beamercolorbox}[sep=8pt,center]{date}
        \usebeamerfont{date}\underline{\insertdate}
    \end{beamercolorbox}
    \vskip1.5em
    \begin{beamercolorbox}[sep=8pt,center]{institute}
        \usebeamerfont{institute}\insertinstitute
    \end{beamercolorbox}
    \ifthenelse{\isundefined{\@id}}{
        \begin{beamercolorbox}[sep=0pt,center]{author}
            \usebeamerfont{author}\insertauthor
        \end{beamercolorbox}
    }{
        \begin{beamercolorbox}[sep=0pt,center]{author}
            {\small 学籍番号~\@id}\hspace{5pt}\usebeamerfont{author}\insertauthor
        \end{beamercolorbox}
    }
    %\ifx\@id\empty
        
    %\else
        
    %\fi
    \vskip0.5em
    {\usebeamercolor[fg]{titlegraphic}\inserttitlegraphic\par}

    % 学会名入れる場合以下
    % \vskip3em\par
    % \begin{beamercolorbox}[sep=8pt,center]{author}
    %     {\usebeamerfont{author}\insertauthor}~~
    %     {\usebeamerfont{institute}(\insertinstitute)}
    % \end{beamercolorbox}
    % \begin{beamercolorbox}[sep=8pt,center]{conference name}
    %     \usebeamerfont{date}Conference Name
    % \end{beamercolorbox}
    % \begin{beamercolorbox}[sep=0pt,center]{date}
    %     \usebeamerfont{date}\underline{\insertdate}
    % \end{beamercolorbox}
    % \vskip0.5em
    % {\usebeamercolor[fg]{titlegraphic}\inserttitlegraphic\par}

    \endgroup
    \vfill
}
\makeatother

%==============================================================================

% comment 機能
\newcommand{\notecomment}[1]{\centering\framebox{\color{magenta}{\textbf{\textit{#1}}}}}
\usepackage{comment}

% 弱強調 機能
\newcommand{\blert}[1]{{\color{BlertColor}\textbf{{#1}}}}
% 赤いアンダーライン
\newcommand{\redunderline}[1]{\textcolor{AlertRed}{\underline{\textcolor{MainTextColor}{#1}}}}

% 数式(演算子など)のスペースを詰める
\thickmuskip = 1.2\thickmuskip   % =,→ 間の余白
\medmuskip   = 1.1\medmuskip     % +,- 間の余白
\thinmuskip  = 1.0\thinmuskip    % … などの装飾記号の余白
\arraycolsep = 0.3\arraycolsep   % 行列を詰める

% 数式の上下のスペースの変更
\AtBeginDocument{
  \abovedisplayskip      = 0.3\abovedisplayskip
  \abovedisplayshortskip = 0.5\abovedisplayshortskip
  \belowdisplayskip      = 0.5\belowdisplayskip
  \belowdisplayshortskip = 0.5\belowdisplayshortskip
}

% 擬似コード記述
\usepackage{algorithmic}
\usepackage{algorithm}
% RequireとEnsureをInputとOutputにする
\renewcommand{\algorithmicrequire}{\textbf{Input:}}
\renewcommand{\algorithmicensure}{\textbf{Output:}}

% table settings
\usepackage{multirow}               % 縦に結合
\renewcommand{\arraystretch}{1.2}   % 高さを少し広く

% figure settings
\usepackage{graphicx}
\graphicspath{}

\setbeamertemplate{caption}[numbered]   % 図表に番号をつける

% 脚注を ＊1 にする
\renewcommand{\thefootnote}{$\ast$\arabic{footnote}}

% citation settings
\usepackage[square,authoryear,sort]{natbib}
\setcitestyle{square,aysep={},citesep={,}}  % [名前 年, 名前 年]
\bibliographystyle{plainnat}

% tikz グラフ描画
\usepackage{tikz}
\usetikzlibrary{intersections,calc,arrows.meta}

\renewcommand{\appendixname}{\texorpdfstring{\translate{Appendix}}{Appendix}}
